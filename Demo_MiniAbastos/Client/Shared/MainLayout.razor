@inherits LayoutComponentBase
@inject IJSRuntime js
@inject IManager manager
@inject IMostrarMensajes mostrarMensajes
@inject NavigationManager navigate


<div class="page">
    <main>

        <header class="pt-2 bg-ligh" style="background-color:#FAE91C">

            <div class="container d-flex flex-wrap justify-content-between align-items-center px-5">

                <a href="/" id="logoMiniabastos" class="d-flex align-items-center">
                    <img src="/Logo_MiniAbastos_SinFondo 1.png" width="105" alt="Logo_Miniabastos">
                </a>

                <form id="inputBusqueda" class="col-12 col-lg-6 mb-3 mb-lg-0">
                    <input type="search" class="form-control form-control-lg" placeholder="Busca productos, marcas y mas..."
                           aria-label="Search" list="datalistOptions" @onchange="IrAPagina">
                    <datalist id="datalistOptions">
                        <option value="Aceite vegetal 123 1L"></option>
                        <option value="Café soluble Nescafé Clásico 200 g"></option>
                        <option value="Pañal Absorsec Mediano"></option>
                        <option value="Tempra Forte adultos 650 mg 24 tabletas"></option>
                        <option value="Frijoles negros Isadora "></option>
                    </datalist>
                </form>

                <a href="/ofertas">
                    <span class="badge d-flex align-items-center p-1 pe-2 text-success-emphasis bg-success-subtle border border-success-subtle rounded-pill">
                        <img class="rounded-circle me-1" width="24" height="24" src="/Imagenes_Productos/descuento.png" alt="">Ofertas
                    </span>
                </a>


            </div>

        </header>

        <nav class="border boder-top border-white" style="background-color:#FAE91C">
            <div class="container d-flex flex-wrap justify-content-between align-items-center px-5">

                <button type="button" class="btn btn-sm btn-light" data-bs-toggle="modal" data-bs-target="#modalTipoEntrega">
                    Escoge el tipo de entrega
                </button>

                <ul class="nav">
                    <li class="nav-item dropdown" id="listaCategorias">
                        <a class="nav-link dropdown-toggle text-black" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Departamentos
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                            <li>
                                <a class="dropdown-item d-flex align-items-center gap-2 py-2" href="/abarrotes">
                                    <span class="d-inline-block bg-warning rounded-circle p-1"></span>
                                    Abarrotes
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item d-flex align-items-center gap-2 py-2" href="/medicina">
                                    <span class="d-inline-block bg-primary rounded-circle p-1"></span>
                                    Medicina
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item d-flex align-items-center gap-2 py-2" href="/lacteos">
                                    <span class="d-inline-block bg-info rounded-circle p-1"></span>
                                    Lacteos
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item d-flex align-items-center gap-2 py-2" href="/dulces">
                                    <span class="d-inline-block bg-success rounded-circle p-1"></span>
                                    Dulces
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item d-flex align-items-center gap-2 py-2" href="/licores">
                                    <span class="d-inline-block bg-danger rounded-circle p-1"></span>
                                    Licores
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown" id="listaMarcas">
                        <a class="nav-link dropdown-toggle text-black" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Marcas
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                            <li>
                                <a class="dropdown-item d-flex gap-2 align-items-center" href="/producto/8">
                                    <img class="rounded" width="126" src="/Imagenes_Productos/Frame 15 (1).png" alt="">
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item d-flex gap-2 align-items-center" href="/producto/2">
                                    <img class="rounded" width="126" src="/Imagenes_Productos/Logo_Nescafe.png" alt="">
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item d-flex gap-2 align-items-center" href="/producto/9">
                                    <img class="rounded" width="126" src="/Imagenes_Productos/Frame 17 (1).png" alt="">
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item d-flex gap-2 align-items-center" href="/producto/3">
                                    <img class="rounded" width="126" src="/Imagenes_Productos/Logo_Maruchan.png" alt="">
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item d-flex gap-2 align-items-center" href="/producto/10">
                                    <img class="rounded" width="126" src="/Imagenes_Productos/Frame 18 (1).png" alt="">
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item"><a href="/sucursales" class="nav-link link-dark px-2">Sucursales</a></li>
                    <li class="nav-item"><a href="/historia" class="nav-link link-dark px-2">Historia</a></li>
                </ul>

                <div class="btn-group btn-group-sm" role="group" aria-label="Basic outlined example" title="Perfil, Pedidos, Cuentas">

                    <a href="/perfil" class="btn btn-sm btn-outline-dark"><i class="bi bi-file-person me-2"></i>Roman Alejandro</a>

                    <button type="button" class="btn btn-outline-dark" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNotificaciones" aria-controls="offcanvasNotificaciones">
                        <i class="bi bi-bell"></i>
                    </button>

                    @*<button type="button" class="btn btn-outline-dark">
                    <i class="bi bi-cart"></i>
                    </button>*@
                </div>

            </div>
        </nav>

        <article class="content px-4">
            @Body
        </article>

        <div id="footer" class="container-fluid px-0" style="background-color:#E24F38">
            <footer class="d-flex flex-wrap justify-content-between align-items-center py-2 px-5 border-top">
                <div class="col-md-4 d-flex align-items-center">
                    <a href="/" class="mb-3 me-2 mb-md-0 text-body-secondary text-decoration-none lh-1">
                        <img src="/Imagenes_Productos/Logo_MiniAbastos_Footer.png" width="80" alt="Logo_Miniabastos">
                    </a>
                    <span class="text-white">Mini Abastos S.A. de C.V.</span>
                </div>

                <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
                    <li class="ms-3">
                        <a class="text-white" href="https://twitter.com/" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-twitter" viewBox="0 0 16 16">
                                <path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" />
                            </svg>
                            <use xlink:href="#facebook"></use>
                        </a>
                    </li>
                    <li class="ms-3">
                        <a class="text-white" href="https://www.youtube.com/" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-youtube" viewBox="0 0 16 16">
                                <path d="M8.051 1.999h.089c.822.003 4.987.033 6.11.335a2.01 2.01 0 0 1 1.415 1.42c.101.38.172.883.22 1.402l.01.104.022.26.008.104c.065.914.073 1.77.074 1.957v.075c-.001.194-.01 1.108-.082 2.06l-.008.105-.009.104c-.05.572-.124 1.14-.235 1.558a2.007 2.007 0 0 1-1.415 1.42c-1.16.312-5.569.334-6.18.335h-.142c-.309 0-1.587-.006-2.927-.052l-.17-.006-.087-.004-.171-.007-.171-.007c-1.11-.049-2.167-.128-2.654-.26a2.007 2.007 0 0 1-1.415-1.419c-.111-.417-.185-.986-.235-1.558L.09 9.82l-.008-.104A31.4 31.4 0 0 1 0 7.68v-.123c.002-.215.01-.958.064-1.778l.007-.103.003-.052.008-.104.022-.26.01-.104c.048-.519.119-1.023.22-1.402a2.007 2.007 0 0 1 1.415-1.42c.487-.13 1.544-.21 2.654-.26l.17-.007.172-.006.086-.003.171-.007A99.788 99.788 0 0 1 7.858 2h.193zM6.4 5.209v4.818l4.157-2.408L6.4 5.209z" />
                                <use xlink:href="#facebook"></use>
                            </svg>
                        </a>
                    </li>
                    <li class="ms-3">
                        <a class="text-white" href="https://www.facebook.com/MiniAbastosOax" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-facebook" viewBox="0 0 16 16">
                                <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z" />
                                <use xlink:href="#facebook"></use>
                            </svg>
                        </a>
                    </li>
                    <li class="ms-3">
                        <a class="text-white" href="https://mail.google.com/mail/u/0/?hl=es-419" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-envelope-fill" viewBox="0 0 16 16">
                                <path d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414.05 3.555ZM0 4.697v7.104l5.803-3.558L0 4.697ZM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586l-1.239-.757Zm3.436-.586L16 11.801V4.697l-5.803 3.546Z" />
                            </svg>
                        </a>
                    </li>
                </ul>
            </footer>
        </div>

        <!-- MODAL TIPO ENTREGA-->
        <div class="modal fade" id="modalTipoEntrega" tabindex="-1" aria-labelledby="modalTipoEntregaLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered">
                <div class="modal-content">

                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Tipo Entrega</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        <div class="row">
                            <div class="col-6">
                                <div class="card">
                                    <img src="/Imagenes_Productos/casa.png" class="card-img-top" style="width:100px; margin:auto" alt="...">
                                    <div class="card-body">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1"
                                                   value="EntregaDomicilio" @onchange="SeleccionarLugarEntregaPedido">
                                            <label class="form-check-label h6" for="inlineRadio1">Entrega a Domicilio</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-6">
                                <div class="card">
                                    <img src="/Imagenes_Productos/almacen.png" class="card-img-top" style="width:100px; margin:auto" alt="...">
                                    <div class="card-body">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2"
                                                   value="EntregaSucursal" @onchange="SeleccionarLugarEntregaPedido">
                                            <label class="form-check-label h6" for="inlineRadio2">Entrega en Sucursal</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            @if (MostrarSeleccionarSucursal)
                            {
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <div class="input-group mb-3">
                                            <span class="input-group-text">CP o Sucursal</span>
                                            <input type="text" class="form-control">
                                            <button class="btn btn-outline-secondary" type="button">Buscar</button>
                                        </div>

                                    </div>

                                    <div class="col-12" style="height:250px;">
                                        <div class="list-group">
                                            @foreach (var ubicacion in Ubicaciones.Where(x => x.EsSucursal == true))
                                            {
                                                <label class="list-group-item d-flex gap-2">
                                                    <input class="form-check-input flex-shrink-0" type="radio" name="listGroupRadios" id="listGroupRadios1" value="" checked="">
                                                    <span>
                                                        @ubicacion.Nombre
                                                        <small class="d-block text-body-secondary">@ubicacion.Direccion</small>
                                                    </span>
                                                </label>
                                            }
                                        </div>
                                    </div>
                                </div>
                            }

                            @if (MostrarSeleccionarDomicilio)
                            {
                                <div class="row mt-3">
                                    <div class="col-12 mb-3 pb-3">
                                        <button class="btn btn-sm btn-warning w-100" data-bs-toggle="modal" data-bs-target="#modalAgregarDomicilio">Agregar Direccion</button>
                                    </div>

                                    <div class="col-12" style="height:250px;">
                                        <div class="list-group mb-3 pb-4">
                                            @foreach (var ubicacion in Ubicaciones.Where(x => x.EsSucursal == false))
                                            {
                                                <label class="list-group-item d-flex gap-2">
                                                    <input class="form-check-input flex-shrink-0" type="radio" name="listGroupRadios" id="listGroupRadios1" value="" checked="">
                                                    <span>
                                                        @ubicacion.Nombre
                                                        <small class="d-block text-body-secondary">@ubicacion.Direccion</small>
                                                    </span>
                                                </label>
                                            }
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Guardar Cambios</button>
                    </div>

                </div>
            </div>
        </div>

        <!--MODAL AGREGAR DOMICILIO-->
        <div class="modal fade" id="modalAgregarDomicilio" aria-hidden="true" aria-labelledby="modalAgregarDomicilioLabel2" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="modalAgregarDomicilioLabel2">Nueva Direccion</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                        <div class="row g-4">

                            <div class="col-12 mt-2">
                                <Demo_MiniAbastos.Client.Pages.CapturaDomicilio Domicilio="@Domicilio" CodigoPostal="@Domicilio.CodigoPostal" @bind-Procesando="procesando" />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-target="#modalTipoEntrega" data-bs-toggle="modal">Cancelar</button>
                        <button class="btn btn-primary" data-bs-target="#modalTipoEntrega" data-bs-toggle="modal" @onclick="GuardarUbicacion">Guardar</button>
                    </div>
                </div>
            </div>
        </div>

        <!--OFFCANVAS NOTIFICACIONES-->
        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNotificaciones" aria-labelledby="offcanvasNotificacionesLabel">
            <div class="offcanvas-header">
                <h5 id="offcanvasNotificacionesLabel">Notificaciones</h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <div class="list-group">

                    <a href="#" class="list-group-item list-group-item-success list-group-item-action" aria-current="true">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">Pedido Guardado</h5>
                            <small>Ayer 12:21 pm</small>
                        </div>
                        <p class="mb-1">5 artículos - Total: $ 3,280.80</p>
                        <small>Entrega en Domicilio 69940 para el 25/10/2023</small>
                    </a>

                    <a href="#" class="list-group-item list-group-item-primary list-group-item-action" aria-current="true">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">Pedido Entregado</h5>
                            <small>10/10/23</small>
                        </div>
                        <p class="mb-1">3 artículos - Total: $ 882.00</p>
                        <small>Entrega en Sucursal Nochixtlan para el 15/10/2023</small>
                    </a>

                    <a href="#" class="list-group-item list-group-item-primary list-group-item-action" aria-current="true">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">Pedido Entregado</h5>
                            <small>Hace 2 días</small>
                        </div>
                        <p class="mb-1">1 artículos - Total: $ 288.00</p>
                        <small>Entrega en Sucursal Nochixtlan</small>
                    </a>

                </div>
            </div>
        </div>

    </main>
</div>


@code {
    bool CargandoInformacion = new bool();

    private bool procesando = false;

    string tipoEntrega = string.Empty;

    bool MostrarSeleccionarSucursal = false;
    bool MostrarSeleccionarDomicilio = false;

    Domicilio Domicilio = new Domicilio();

    Ubicacion ubicacionEdicion = new Ubicacion();
    string codigoPostal = string.Empty;
    string calle = string.Empty;
    string numeroExterior = string.Empty;
    string localidad = string.Empty;
    string municipio = string.Empty;

    public List<Ubicacion> Ubicaciones = new List<Ubicacion>();

    protected override async Task OnInitializedAsync()
    {
        CargandoInformacion = true;

        var respuesta = await manager.Get<List<Ubicacion>>("api/productos/GetUbicaciones");

        if (respuesta.Estado == EstadosDeRespuesta.Error)
        {
            await mostrarMensajes.MostrarMensajeError(respuesta.Mensaje);
        }
        else
        {
            Ubicaciones = respuesta.Datos;
        }

        CargandoInformacion = false;
    }

    private void SeleccionarLugarEntregaPedido(ChangeEventArgs e)
    {
        var selectedValue = e.Value.ToString();

        if (selectedValue == "EntregaDomicilio")
        {
            MostrarSeleccionarDomicilio = true;
            MostrarSeleccionarSucursal = false;
        }
        else if (selectedValue == "EntregaSucursal")
        {
            MostrarSeleccionarSucursal = true;
            MostrarSeleccionarDomicilio = false;
        }
    }

    public async Task GuardarUbicacion()
    {
        procesando = true;
        Ubicacion nuevaUbicacion = new Ubicacion();       

        nuevaUbicacion.Nombre = Domicilio.NombreDomicilio;
        nuevaUbicacion.Direccion = $"{Domicilio.CodigoPostal}, {Domicilio.Calle} {Domicilio.NumeroExterior}, {Domicilio.Municipio}, {Domicilio.Estado}.";

        var respuesta = await manager.Post<Ubicacion, long>("api/productos/GuardarUbicacion", nuevaUbicacion);

        if (respuesta.Estado == EstadosDeRespuesta.Error)
        {
            await mostrarMensajes.MostrarMensajeError(respuesta.Mensaje);
        }
        else
        {
            Ubicaciones.Add(nuevaUbicacion);
            ubicacionEdicion = new Ubicacion();
            Domicilio = new Domicilio();
        }
        procesando = false;
    }

    public void IrAPagina(ChangeEventArgs e)
    {
        string selectedOption = e.Value.ToString();

        Console.WriteLine(selectedOption);

        if (selectedOption == "Aceite vegetal 123 1L")
        {
            navigate.NavigateTo("/1 2 3");
        }
        else if (selectedOption == "Café soluble Nescafé Clásico 200 g")
        {
            navigate.NavigateTo("/Nescafe");
        }
    }

    public void IrAPaginaAceiteVegetal()
    {
        navigate.NavigateTo("/aceite123");
    }

    public void IrAPaginaNescafe()
    {
        navigate.NavigateTo("/nescafe200g");
    }
}